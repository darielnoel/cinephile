define(["jquery","jquerySerialize","jqueyStarRating","underscore","backbone","models/movie/MovieModel","text!templates/movies/movieDetailTemplate.html","text!templates/movies/movieDetailActorsListTemplate.html","text!templates/movies/moviesRelatesTemplate.html"],function(a,b,c,d,e,f,g,h,i){var j=e.View.extend({el:a("#movie-detail"),events:{"click .cancel":"cancelItem"},model:{},initialize:function(a){var b=this;b.moviesCollection=a.moviesCollection,b.actorsCollection=a.actorsCollection,b.router=a.router},render:function(b){var c,e=this,f=b.id,j=e.$el;e.moviesCollection.fetch(),f&&(c=e.moviesCollection.get(f),e.model=c,e.model.fetch({success:function(a){var b,c,k,l=d.template(g,{data:a}),m=[];j.html(l);var n=j.find(".rating");n.rating(),n.on("rating.change",function(a,b){e.model.setRating(b),e.model.save(),n.rating("update",e.model.get("rating"))}),e.actorsCollection.fetch(),d.each(e.model.get("actorCollection"),function(a){m.push(e.actorsCollection.get(a))}),b=d.template(h,{data:m}),j.find(".movie-actor-list").html(b),k=e.moviesCollection.getRelatesMovies(f),c=d.template(i,{data:k}),j.find(".relates-movies-list").html(c)}})),j.find("#files").change(a.proxy(e.handleFileSelect,e)),e.show()},handleFileSelect:function(a){for(var b,c=this,d=c.$el,e=a.target.files,f=0;b=e[f];f++)if(b.type.match("image.*")){var g=new FileReader;g.onload=function(){return function(a){d.find("#store-image img").attr("src",a.target.result),c.model.set("image",a.target.result)}}(b),g.readAsDataURL(b)}},cancelItem:function(){this.router.navigate("movies",{trigger:!0})},hide:function(){this.$el.hide()},show:function(){this.$el.show()}});return j});