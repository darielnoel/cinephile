define(["jquery","jquerySerialize","underscore","backbone","models/movie/MovieModel","text!templates/movies/movieEditTemplate.html","text!templates/movies/movieActorsListTemplate.html","text!templates/movies/movieToAddActorListTemplate.html","text!templates/actors/actorsTrTemplate.html"],function(a,b,c,d,e,f,g,h,i){var j="actorCollection",k="movies",l=d.View.extend({el:a("#movie-edit"),events:{"submit .movies-edit-form":"saveItem","click .delete":"deleteItem","click .cancel":"cancelItem","click .delete-actor-from-movie":"deleteActorFromMovie","click .show-actor-to-movie":"showActorToMovieView","click .add-actor-to-movie":"addActorToMovie","click .close-actor-to-movie":"closeActorToMovieView"},model:{},initialize:function(a){var b=this;b.moviesCollection=a.moviesCollection,b.actorsCollection=a.actorsCollection,b.router=a.router},render:function(a){var b,d,h=this,i=a.id,k=h.$el;h.moviesCollection.fetch(),i?(d=h.moviesCollection.get(i),h.model=d,h.model.fetch({success:function(a){var b,d,e=c.template(f,{data:a}),i=[],l=[];k.html(e),h.actorsCollection.fetch(),c.each(h.model.get(j),function(a){b=h.actorsCollection.get(a),b&&(i.push(h.actorsCollection.get(a)),l.push(a))}),h.model.set(j,l),h.model.save(),d=c.template(g,{data:i}),k.find(".movie-actor-list").prepend(d)}})):(d=new e,h.model=d,b=c.template(f,{data:d}),k.html(b)),h.show()},deleteActorFromMovie:function(b){var d=this,e=a(b.currentTarget),f=e.attr("data-id"),g=d.model.get(j);g=c.without(g,f),d.model.set(j,g),e.parents("tr").remove()},showActorToMovieView:function(b){this.actorsCollection.fetch();var d=this,e=d.$el,f=d.actorsCollection.models,g=c.template(h,{data:f}),i=e.find(".movie-toadd-actor-list");i.html(g),e.find(".movie-form").hide(),i.show(),a(b.currentTarget).hide(),e.find(".close-actor-to-movie").show()},closeActorToMovieView:function(b){var c=this.$el;c.find(".movie-form").show(),c.find(".movie-toadd-actor-list").hide(),a(b.currentTarget).hide(),c.find(".close-actor-to-movie").hide(),c.find(".show-actor-to-movie").show()},addActorToMovie:function(b){var d,e,f=this,g=a(b.currentTarget),h=g.attr("data-id"),k=f.model.get(j);c.contains(k,h)||(k.push(h),e=f.actorsCollection.get(h),d=c.template(i,{data:e}),f.$el.find(".movie-actor-list table tbody").append(d))},saveItem:function(b){var c=this,d=a(b.currentTarget).serializeObject();return d.cid&&c.moviesCollection.add(c.model),c.model.save(d,{success:function(){c.router.navigate(k,{trigger:!0})}}),!1},cancelItem:function(){this.router.navigate(k,{trigger:!0})},deleteItem:function(){var a=this;a.model.destroy({success:function(){a.router.navigate(k,{trigger:!0})}})},hide:function(){this.$el.hide()},show:function(){this.$el.show()}});return l});